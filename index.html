<html>

<head>
    <title>NZIMD 2018 Chernoff Faces</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css"
        integrity="sha256-iYUgmrapfDGvBrePJPrMWQZDcObdAcStKBpjP3Az+3s=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"
        integrity="sha256-CNm+7c26DTTCGRQkM9vp7aP85kHFMqs9MhPEuytF+fQ=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet-providers@1.3.0/leaflet-providers.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.0.3/chroma.min.js"></script>
    
    <script type="text/javascript" src="http://www.larsko.org/v/d3.min.js"></script>
    <script type="text/javascript" src="http://www.larsko.org/v/hpi/chernoff.js"></script>

    <style>
        body,
        html,
        #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        #title {
            flex: auto;
            margin: 0;
            text-align: center;
            color: white;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.8);
            font-size: 1rem;
            font-family: Arial, Helvetica, sans-serif;
            text-shadow: 2px 2px #000000;
            font-weight: normal;
        }

        .face {
            background-color: white;
        }
    </style>

</head>

<body>
    <h1 id="title">NZIMD 2018 Chernoff Faces</h1>
    <div id="map"></div>
    </div>
    <script>
        var map = L.map('map', {
            zoom: 6,
            minZoom: 6,
            maxZoom: 14,
            center: [-41.235726, 172.5118422]
        });
        var bounds = map.getBounds();
        bounds._northEast.lat += 10;
        bounds._northEast.lng += 10;
        bounds._southWest.lat -= 10;
        bounds._southWest.lng -= 10;
        map.setMaxBounds(bounds);

        var baseMaps = {
            "OSM": L.tileLayer.provider("OpenStreetMap.Mapnik"),
            "OSM Grayscale": L.tileLayer.provider("OpenStreetMap.BlackAndWhite"),
            "CartoDB Positron": L.tileLayer.provider('CartoDB.PositronNoLabels').addTo(map),
            "CartoDB Dark Matter": L.tileLayer.provider("CartoDB.DarkMatter"),
            "ESRI WorldImagery": L.tileLayer.provider("Esri.WorldImagery"),
            "Google Hybrid": L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}', {
                maxZoom: 20,
                subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
            }),
            "Wikimedia": L.tileLayer.provider("Wikimedia")
        }

        map.createPane('labels');
        map.getPane('labels').style.zIndex = 625;
        map.getPane('labels').style.pointerEvents = 'none';
        var labels = L.tileLayer.provider("Stamen.TonerLabels", {
            pane: "labels",
            interactive: false,
            opacity: .8,
        });

        map.createPane('whitelabels');
        map.getPane('whitelabels').style.zIndex = 625;
        map.getPane('whitelabels').style.pointerEvents = 'none';
        map.getPane('whitelabels').style.filter = 'invert(100%)';
        var whitelabels = L.tileLayer.provider("Stamen.TonerLabels", {
            pane: "whitelabels",
            interactive: false,
            opacity: .8,
        });

        var imdLayer = L.layerGroup().addTo(map);
        var facesLayer = L.layerGroup().addTo(map);

        var overlayMaps = {
            "NZIMD 2018": imdLayer,
            "Chernoff faces": facesLayer,
            "City labels": labels,
            "City labels (white)": whitelabels,
        }

        L.control.layers(baseMaps, overlayMaps).addTo(map);

        var NZIMD_cmap = chroma.scale("BuPu").domain([1, 6181])

        var customLayer = L.geoJson(null, {
            interactive: false,
            onEachFeature: function (feature, layer) {
                console.log(feature)
                var icon = L.divIcon({
                    className: "face",
                    iconSize: [20, 20]
                });
                L.marker(layer.getBounds().getCenter(), {icon: icon}).addTo(facesLayer)
            },
            style: function (feature) {
                return {
                    fillColor: NZIMD_cmap(feature.properties.IMD18),
                    fillOpacity: .5,
                    color: "black",
                    //dashArray: "2,2",
                    weight: .5
                }
            }
        });
        omnivore.topojson('https://uoa-eresearch.github.io/cancermap/data/IMD18.topojson', null, customLayer).addTo(imdLayer);

    </script>
</body>

</html>